

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cymetric Tutorial &#8212; Home</title>
    
    <link rel="stylesheet" href="../../_static/cyclus.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '(1.5.0-17-g9a707ee)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../_static/big_c.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cymetric API" href="api/index.html" />
    <link rel="prev" title="Cymetric" href="index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="api/index.html" title="Cymetric API"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Cymetric"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> User Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Cymetric</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cymetric-tutorial">
<span id="cym-tutorial"></span><h1>Cymetric Tutorial<a class="headerlink" href="#cymetric-tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will describe how to use cymetric from the command line or using
Python. It also discusses how to write your own metrics for custom analyses.</p>
<p>Cymetric is an extension of <span style="font-variant:small-caps;">Cyclus</span>, so it is assumed that <span style="font-variant:small-caps;">Cyclus</span> is already
installed on your system. (If not, please visit <a class="reference external" href="http://fuelcycle.org/kernel/build_from_source.html">Getting and Building Cyclus
from Source</a>.) Cymetric
installation instructions are available on <a class="reference external" href="https://github.com/cyclus/cymetric">GitHub</a>.</p>
<p>Cymetric operates by reading data from a <span style="font-variant:small-caps;">Cyclus</span> database, computing metrics,
and writing those metrics back to the database. This way, previously seen
metrics are stored for later retrieval. The dependencies between metrics are
automatically computed and evaluated.</p>
<p>Without further ado, let&#8217;s dive in!</p>
<div class="section" id="command-line-usage">
<h2>Command Line Usage<a class="headerlink" href="#command-line-usage" title="Permalink to this headline">¶</a></h2>
<p>Cymetric ships with a command line utility, just called <code class="docutils literal"><span class="pre">cymetric</span></code>.
The command line tool is useful for quick feedback. It can show a list of
tables in a database or execute some code using a database, e.g., evaluating
a metric or quickly checking a plot.</p>
<p>Since cymetric is wholly dependent on <span style="font-variant:small-caps;">Cyclus</span> databases, you must supply a
database as an argument on the command line. This will look something like the
following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric database -flags
</pre></div>
</div>
<p>We&#8217;ll be using <code class="docutils literal"><span class="pre">test.h5</span></code> and <code class="docutils literal"><span class="pre">test.sqlite</span></code> as our example databases here.
The sections below explain the flags for use on the command line.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Please note that cymetric may not work on the command line within its own directory.</p>
</div>
<div class="section" id="table-listing-l">
<h3>Table Listing: <code class="docutils literal"><span class="pre">-l</span></code><a class="headerlink" href="#table-listing-l" title="Permalink to this headline">¶</a></h3>
<p>The first switch here, lowercase-L <code class="docutils literal"><span class="pre">-l</span></code>, simply lists the tables in the
database.  Note that this may list more tables in the database than are
strictly part of the <span style="font-variant:small-caps;">Cyclus</span> interface, because of the need for <span style="font-variant:small-caps;">Cyclus</span> to
store metadata. Don&#8217;t be alarmed. Listing the current tables is easy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -l
AgentEntry
AgentStateAgent
AgentStateInventories
AgentState_agents_NullRegionInfo
...
BlobKeys
BlobVals
BuildSchedule
Compositions
DecayMode
Finish
Info
InputFiles
MaterialInfo
NextIds
Prototypes
Recipes
ResCreators
Resources
Snapshots
StringKeys
StringVals
Transactions
XMLPPInfo
</pre></div>
</div>
<p>Metrics that are generated will show up in this listing after they have been
computed. All of the core <span style="font-variant:small-caps;">Cyclus</span> tables are denoted as root metrics, and they
are listed here too. To understand the core tables included in a <span style="font-variant:small-caps;">Cyclus</span>
database, please review the page <a class="reference external" href="http://fuelcycle.org/user/dbdoc.html">Understanding the Database</a>.</p>
</div>
<div class="section" id="code-execution-e">
<h3>Code Execution: <code class="docutils literal"><span class="pre">-e</span></code><a class="headerlink" href="#code-execution-e" title="Permalink to this headline">¶</a></h3>
<p>Cymetric allows you to execute arbitrary code on metrics from the command line
with the <code class="docutils literal"><span class="pre">-e</span></code> flag. The code that you pass in is pure Python. Every metric
and root <span style="font-variant:small-caps;">Cyclus</span> table are assigned automatically to variable names that you
can use. Indexing the table variables will return the metric as a <a class="reference external" href="http://pandas.pydata.org/">pandas</a> DataFrame. For example, to print the
<code class="docutils literal"><span class="pre">AgentEntry</span></code> table, we would write <code class="docutils literal"><span class="pre">AgentEntry[:]</span></code> to get the table and
<code class="docutils literal"><span class="pre">print(AgentEntry[:])</span></code> to display it after the <code class="docutils literal"><span class="pre">-e</span></code> flag:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -e <span class="s2">&quot;print(AgentEntry[:])&quot;</span>
                                  SimId  AgentId      Kind                    Spec          Prototype  ParentId  Lifetime  EnterTime
<span class="m">0</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">11</span>    Region      :agents:NullRegion       SingleRegion        -1        -1          0
<span class="m">1</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">12</span>      Inst    :cycamore:DeployInst  SingleInstitution        <span class="m">11</span>        -1          0
<span class="m">2</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">13</span>  Facility        :cycamore:Source         UOX_Source        <span class="m">12</span>        -1          1
<span class="m">3</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">14</span>  Facility        :cycamore:Source         MOX_Source        <span class="m">12</span>        -1          1
<span class="m">4</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">15</span>  Facility  :cycamore:BatchReactor           Reactor1        <span class="m">12</span>        -1          1
<span class="m">5</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">16</span>  Facility  :cycamore:BatchReactor           Reactor2        <span class="m">12</span>        -1          2
<span class="m">6</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">17</span>  Facility  :cycamore:BatchReactor           Reactor3        <span class="m">12</span>        -1          3

<span class="o">[</span><span class="m">7</span> rows x <span class="m">8</span> columns<span class="o">]</span>
</pre></div>
</div>
<p>Indexing a metric with an empty slice (<code class="docutils literal"><span class="pre">[:]</span></code>), none (<code class="docutils literal"><span class="pre">[None]</span></code>), or an ellipsis
(<code class="docutils literal"><span class="pre">[...]</span></code>) will return the full metric. However, you can also index by condition
filters on the column names. The column names of the metric are thus also available for
use.  For example, let&#8217;s just grab all of the facilities out of the entry table:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -e <span class="s2">&quot;print(AgentEntry[Kind == &#39;Facility&#39;])&quot;</span>
                                  SimId  AgentId      Kind                    Spec   Prototype  ParentId  Lifetime  EnterTime
<span class="m">0</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">13</span>  Facility        :cycamore:Source  UOX_Source        <span class="m">12</span>        -1          1
<span class="m">1</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">14</span>  Facility        :cycamore:Source  MOX_Source        <span class="m">12</span>        -1          1
<span class="m">2</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">15</span>  Facility  :cycamore:BatchReactor    Reactor1        <span class="m">12</span>        -1          1
<span class="m">3</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">16</span>  Facility  :cycamore:BatchReactor    Reactor2        <span class="m">12</span>        -1          2
<span class="m">4</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">17</span>  Facility  :cycamore:BatchReactor    Reactor3        <span class="m">12</span>        -1          3

<span class="o">[</span><span class="m">5</span> rows x <span class="m">8</span> columns<span class="o">]</span>
</pre></div>
</div>
<p>Separate the conditions by commas (<code class="docutils literal"><span class="pre">,</span></code>) to apply multiple filters at the same
time:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -e <span class="s2">&quot;print(AgentEntry[Kind == &#39;Facility&#39;, AgentId &gt; 14])&quot;</span>
                                  SimId  AgentId      Kind                    Spec Prototype  ParentId  Lifetime  EnterTime
<span class="m">0</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">15</span>  Facility  :cycamore:BatchReactor  Reactor1        <span class="m">12</span>        -1          1
<span class="m">1</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">16</span>  Facility  :cycamore:BatchReactor  Reactor2        <span class="m">12</span>        -1          2
<span class="m">2</span>  db805939-c565-404a-9483-adfb3da8b6d2       <span class="m">17</span>  Facility  :cycamore:BatchReactor  Reactor3        <span class="m">12</span>        -1          3

<span class="o">[</span><span class="m">3</span> rows x <span class="m">8</span> columns<span class="o">]</span>
</pre></div>
</div>
<p>Because code execution is just pure Python, we can do <em>anything</em> that we would be
able to do in Python. Suppose that we have a <code class="docutils literal"><span class="pre">Materials</span></code> metric with a <code class="docutils literal"><span class="pre">Mass</span></code>
column. We can compute this metric, pull the column out, multiply it by 42,
save the result to a variable, and then print this variable all via the following.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -e <span class="s2">&quot;mass = Materials[:][&#39;Mass&#39;] * 42; print(mass)&quot;</span>
<span class="m">0</span>      0.000000
<span class="m">1</span>      0.000000
<span class="m">2</span>      0.000000
<span class="m">3</span>      0.000000
<span class="m">4</span>      0.000000
<span class="m">5</span>      0.000000
<span class="m">6</span>      0.000000
<span class="m">7</span>      0.000000
<span class="m">8</span>      0.000000
<span class="m">9</span>      0.000000
<span class="m">10</span>     4.790314
<span class="m">11</span>     0.007370
<span class="m">12</span>     0.066327
<span class="m">13</span>     0.368486
<span class="m">14</span>    33.064222
...
<span class="m">462</span>     0.493771
<span class="m">463</span>     0.313213
<span class="m">464</span>     0.350812
<span class="m">465</span>     0.228541
<span class="m">466</span>    40.917474
<span class="m">467</span>     0.030567
<span class="m">468</span>     0.011288
<span class="m">469</span>     0.238031
<span class="m">470</span>     0.092571
<span class="m">471</span>     0.081648
<span class="m">472</span>     0.034441
<span class="m">473</span>     0.002762
<span class="m">474</span>     0.008074
<span class="m">475</span>     0.000965
<span class="m">476</span>     0.002827
Name: Mass, Length: 477, dtype: float64
</pre></div>
</div>
<p>As a convenience, the following Python modules are available in the execution context
under standard aliases. This prevents you from having to import them manually yourself.</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module</th>
<th class="head">Alias</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">cymetric</span></code></td>
<td><code class="docutils literal"><span class="pre">cym</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">numpy</span></code></td>
<td><code class="docutils literal"><span class="pre">np</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">pandas</span></code></td>
<td><code class="docutils literal"><span class="pre">pd</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">uuid</span></code></td>
<td><code class="docutils literal"><span class="pre">uuid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">matplotlib</span></code></td>
<td><code class="docutils literal"><span class="pre">matplotlib</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code></td>
<td><code class="docutils literal"><span class="pre">plt</span></code></td>
</tr>
</tbody>
</table>
<p>This let&#8217;s you do neat things such as plot the metrics right from the command line.
For example,</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 -e <span class="s2">&quot;Materials[ResourceId == 15].plot(x=&#39;NucId&#39;, y=&#39;Mass&#39;, kind=&#39;bar&#39;); plt.show()&quot;</span>
</pre></div>
</div>
<p>Will pop up with the following figure:</p>
<img alt="../../_images/tut_nucid_mass.png" src="../../_images/tut_nucid_mass.png" />
</div>
<div class="section" id="to-write-or-not-to-write-write-and-no-write">
<h3>To write or not to write: <code class="docutils literal"><span class="pre">--write</span></code> and <code class="docutils literal"><span class="pre">--no-write</span></code><a class="headerlink" href="#to-write-or-not-to-write-write-and-no-write" title="Permalink to this headline">¶</a></h3>
<p>Cymetric automatically writes an evaluated metric to the database. There are
some scenarios when you may not want this to happen. For example, you might
want your script to do many metric calculations and save the results elsewhere;
in this case, writing to the database is unneccessary. While writing is the
default functionality when you use the <code class="docutils literal"><span class="pre">-e</span></code> flag, the lack of writing
can be accomplished with the <code class="docutils literal"><span class="pre">--no-write</span></code> flag. In the example below, the
table will not be written to the database:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 --no-write -e <span class="s2">&quot;Materials[:]&quot;</span>
</pre></div>
</div>
<p>Since cymetric looks up an already evaluated metric in the database,
overwriting an existing table with a new one might be desired. This is where
the <code class="docutils literal"><span class="pre">--write</span></code> flag is useful:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cymetric test.h5 --write -e <span class="s2">&quot;Materials[:]&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="python-interface">
<h2>Python Interface<a class="headerlink" href="#python-interface" title="Permalink to this headline">¶</a></h2>
<p>While quick feedback is useful, it is more likely that cymetric will be of use
in a script.  Therefore, this section details how to employ Python to interact
with cymetric. In addition to writing scripts to compute metrics and produce
figures, this is essential for the development of new metrics.</p>
<p>Typically, it is recommended that you alias <code class="docutils literal"><span class="pre">cymetric</span></code> as <code class="docutils literal"><span class="pre">cym</span></code>, because
all of the important functionality lives here.  To start, use the <code class="docutils literal"><span class="pre">dbopen()</span></code>
function to open up a database:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cymetric</span> <span class="kn">as</span> <span class="nn">cym</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">dbopen</span><span class="p">(</span><span class="s1">&#39;test.sqlite&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="evaluating-metrics">
<h3>Evaluating Metrics<a class="headerlink" href="#evaluating-metrics" title="Permalink to this headline">¶</a></h3>
<p>The main purpose of cymetric is to evaluate metrics. The easiest way to do this
is via the <code class="docutils literal"><span class="pre">eval()</span></code> function. This accepts a metric name and a database and
returns a pandas DataFrame:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;Materials&#39;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</pre></div>
</div>
<p>You may also optionally supply a list of 3-tuples representing the conditions to
filter the metric on.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filtered_frame</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;Materials&#39;</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">conds</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;NucId&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="mi">922350000</span><span class="p">)])</span>
</pre></div>
</div>
<p>As was noted in the previous section, multiple filters can be applied at once.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filtered_frame</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;AgentEntry&#39;</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">conds</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Kind&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="s1">&#39;Facility&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;AgentId&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)])</span>
</pre></div>
</div>
<p>However, if you are evaluating many metrics, this method will be
computationally inefficient. Calling <code class="docutils literal"><span class="pre">eval()</span></code> creates a new <code class="docutils literal"><span class="pre">Evaluator</span></code>
object each time a metric is evaluated. Since each <code class="docutils literal"><span class="pre">Evaluator</span></code> object reads
the database individually, this means <code class="docutils literal"><span class="pre">eval()</span></code> reads the database each time
it is called. Alternatively, there is a way to ensure the database only gets
read once by accessing the <code class="docutils literal"><span class="pre">eval()</span></code> functionality directly within an
<code class="docutils literal"><span class="pre">Evaluator</span></code> object.  You can create an <code class="docutils literal"><span class="pre">Evaluator</span></code> instance with a single
database and call <code class="docutils literal"><span class="pre">eval()</span></code> from within it. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">evaler</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">Evaluator</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">frame1</span> <span class="o">=</span> <span class="n">evaler</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;Materials&#39;</span><span class="p">)</span>
<span class="n">frame2</span> <span class="o">=</span> <span class="n">evaler</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;AgentEntry&#39;</span><span class="p">,</span> <span class="n">conds</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Kind&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;Facility&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>And you can run with the data from there! We recommend learning <a class="reference external" href="http://pandas.pydata.org/">pandas</a> to get the most out of your analysis from this
point.</p>
</div>
<div class="section" id="executing-code">
<h3>Executing Code<a class="headerlink" href="#executing-code" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, you just have a code snippet as a string like you might run from the
command line, even though you are in Python. The <code class="docutils literal"><span class="pre">exec_code()</span></code> function gives
you easy access to the exact same capabilities that you have on the command line.
This function accepts the code string and the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">cym</span><span class="o">.</span><span class="n">exec_code</span><span class="p">(</span><span class="s2">&quot;print(AgentEntry[:])&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</pre></div>
</div>
<p>For more exciting capabilities, please explore the <a class="reference external" href="https://github.com/cyclus/cymetric">examples directory</a> in the cymetric repository or ask us
questions on the <span style="font-variant:small-caps;">Cyclus</span> users mailing list.</p>
</div>
</div>
<div class="section" id="writing-metrics">
<h2>Writing Metrics<a class="headerlink" href="#writing-metrics" title="Permalink to this headline">¶</a></h2>
<p>Naturally, you do not want to be limited to the metrics that come <a class="reference external" href="http://fuelcycle.org/user/cymetric/api/metrics.html">predefined
by cymetric</a>. You have
your own data and your own analysis that you want to perform. It is easy to
write metrics and fully hook into the cymetric tools.</p>
<p>A metric is a function that accepts a pandas Series, returns a
pandas DataFrame, and is decorated by the <code class="docutils literal"><span class="pre">&#64;metric()</span></code> decorator found in
cymetric. The general format is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Table1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Col1&#39;</span><span class="p">,</span> <span class="s1">&#39;Col2&#39;</span><span class="p">),</span> <span class="s1">&#39;Value1&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Table2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Col3&#39;</span><span class="p">,),</span> <span class="s1">&#39;Value2&#39;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="n">schema</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">INT</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;MetricValue&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)]</span>

<span class="nd">@cym.metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyMetric&#39;</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="n">dependencies</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_metric</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">two</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#calculations and pandas manipulations go here</span>
    <span class="k">return</span> <span class="n">dataframe</span>
</pre></div>
</div>
<p>In the above, the <code class="docutils literal"><span class="pre">&#64;metric()</span></code> decorator takes three arguments. The first is
the <code class="docutils literal"><span class="pre">name</span></code> of the metric (e.g., <code class="docutils literal"><span class="pre">'MyMetric'</span></code>). Note that this can be
distinct from the function name.</p>
<p>The second is <code class="docutils literal"><span class="pre">depends</span></code>, which represents the metric dependencies.  This is a
list of 3-tuples that represents which <code class="docutils literal"><span class="pre">series</span></code> to pull out of the database
and pass into the metric function (e.g., <code class="docutils literal"><span class="pre">my_metric()</span></code>).  The entries in the
dependency list have three components. The first element is the table name as a
string (e.g., <code class="docutils literal"><span class="pre">'Table1'</span></code>). The second element is a tuple of column names that
become the index of the series (e.g., <code class="docutils literal"><span class="pre">('Col1',</span> <span class="pre">'Col2')</span></code>). Finally, the last
element is the column of the table that becomes the values of the series (e.g.,
<code class="docutils literal"><span class="pre">'Value1'</span></code>).  A metric may have as many dependencies as required. Circular
dependencies are not allowed.</p>
<p>Lastly, the <code class="docutils literal"><span class="pre">&#64;metric()</span></code> decorator takes a <code class="docutils literal"><span class="pre">schema</span></code> argument. The schema is
defined by a list of 2-tuples. The first entry is the column name and the
second is the <span style="font-variant:small-caps;">Cyclus</span> database type. This represents the structure of the
metric table on disk and in <span style="font-variant:small-caps;">Cyclus</span>. Thus, it is highly tied to the <span style="font-variant:small-caps;">Cyclus</span>
<a class="reference external" href="http://fuelcycle.org/arche/dbtypes.html">type system</a>, as represented in
cymetric. The DataFrame that is returned should have column names that match
the schema provided. It is generally a good idea to include a <code class="docutils literal"><span class="pre">SimId</span></code> column.</p>
<p>For a more concrete example, if you wanted to square the mass of materials as a
metric, you could write a <code class="docutils literal"><span class="pre">MaterialsSquared</span></code> metric.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">deps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Materials&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;SimId&#39;</span><span class="p">,</span> <span class="s1">&#39;ResourceId&#39;</span><span class="p">,</span> <span class="s1">&#39;NucId&#39;</span><span class="p">),</span> <span class="s1">&#39;Mass&#39;</span><span class="p">)]</span>

<span class="n">schema</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;SimId&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">UUID</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ResourceId&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">INT</span><span class="p">),</span>
          <span class="p">(</span><span class="s1">&#39;NucId&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">INT</span><span class="p">),</span>  <span class="p">(</span><span class="s1">&#39;MassSquared&#39;</span><span class="p">,</span> <span class="n">cym</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)]</span>

<span class="nd">@cym.metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MaterialsSquared&#39;</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="n">deps</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mats_sqrd</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="n">mats</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rtn</span> <span class="o">=</span> <span class="n">mats</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">rtn</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;MaterialsSquared&#39;</span>
    <span class="n">rtn</span> <span class="o">=</span> <span class="n">rtn</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">rtn</span>
</pre></div>
</div>
<p>Note that to write this metric, no knowledge of the database or any filters is
assumed. Cymetric handles all of these details for you!</p>
<p>If the pandas functionality seems mysterious to you, it may be beneficial to
review a quick tutorial, <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/10min.html">10 Minutes to pandas</a>.</p>
<p>The above shows how easy it is to incorporate metrics that are computed via
cymetric. Moreover, <span style="font-variant:small-caps;">Cyclus</span> databases can be comprised of both <a class="reference external" href="http://fuelcycle.org/user/dbdoc.html#table-descriptions">default tables</a> and  <a class="reference external" href="http://fuelcycle.org/arche/custom_tables.html">custom tables</a>. Cymetric also helps you
bring in data that might come a custom table in a <span style="font-variant:small-caps;">Cyclus</span> database.  All you
need to do is use the <code class="docutils literal"><span class="pre">root_metric()</span></code> function somewhere. This simply accepts
the name of the table.  For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">my_table</span> <span class="o">=</span> <span class="n">cym</span><span class="o">.</span><span class="n">root_metric</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyTable&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And that is all!</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../index.html" title="index">
          <img class="logo" src="../../_static/big_c.png" alt="Logo"/>
        </a></p><div class="sphinxlocaltoc">
    <h3><a href="../../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Cymetric Tutorial</a><ul>
<li><a class="reference internal" href="#command-line-usage">Command Line Usage</a><ul>
<li><a class="reference internal" href="#table-listing-l">Table Listing: <code class="docutils literal"><span class="pre">-l</span></code></a></li>
<li><a class="reference internal" href="#code-execution-e">Code Execution: <code class="docutils literal"><span class="pre">-e</span></code></a></li>
<li><a class="reference internal" href="#to-write-or-not-to-write-write-and-no-write">To write or not to write: <code class="docutils literal"><span class="pre">--write</span></code> and <code class="docutils literal"><span class="pre">--no-write</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-interface">Python Interface</a><ul>
<li><a class="reference internal" href="#evaluating-metrics">Evaluating Metrics</a></li>
<li><a class="reference internal" href="#executing-code">Executing Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-metrics">Writing Metrics</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="index.html"
                          title="Previous page">&larr; Cymetric</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="api/index.html"
                          title="Next page">&rarr; Cymetric API</a></p>
  </div>
  <div class="sphinxlocaltoc">
  <h3>Useful Pages</h3>
    <ul><li><ul>
    <li><a href="/user/install.html">Install Cyclus</a></li>
    <li><a href="/user/index.html">User Guide</a></li>
    <li><a href="/user/tutorial/index.html">User Tutorial</a></li>
    <li><a href="/arche/index.html">Archetype Developer Guide</a></li>
    <li><a href="/arche/tutorial/index.html">Archetype Developer Tutorial</a></li>
     <li><a href="http://fuelcycle.org/cyclus/api/">Cyclus API Documentation</a></li>
    <li><a href="http://fuelcycle.org/cycamore/api/">Cycamore API Documentation</a></li>
    <li><a href="/basics/glossary.html">Glossary</a></li>
    <li><a href="mailto:cyclus-users+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-users" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Users</a> mailing list.
    <li><a href="mailto:cyclus-dev+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-dev" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Developers</a> mailing list.
    </ul></li></ul>
  </div>
    
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3>Get Cyclus</h3>
    <br>
    Current version: <b>1.5.0</b>
    <br><br>
    Install:
    <div class="highlight-bash" style="width:97.5%"><div class="highlight"><pre><span class="nv">$ </span>conda install cyclus cycamore</pre></div></div>
    Get the Source:
    <ul><li><ul>
          <li><a href="https://github.com/cyclus/cyclus">Cyclus</a></li>
          <li><a href="https://github.com/cyclus/cycamore">Cycamore</a></li>
    </ul></li></ul>
    <h3>Acknowledgements</h3>
    The Cyclus project has received support from:
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../../_static/neup_logo_large.png" width=170px></a>
    <br />
    <br />

    In addition, some of the students working on Cyclus have received support from:
    <br />
    <a href="http://www.anl.gov" target="_blank"><img src="../../_static/AnlLogo.png" height=100px></a>
    <a href="http://www.nrc.gov" target="_blank"><img src="../../_static/USNRC.png" height=100px></a>
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../../_static/neup_logo_large.png" width=170px></a>
    <br />
    <a href="http://www.nsf.gov" target="_blank"><img src="../../_static/nsf_logo.png" height=100px></a>
    <a href="http://www.wisc.edu" target="_blank"><img src="../../_static/crest.png" height=100px></a>
    <a href="http://www.anl.gov" target="_blank"><img src="../../_static/nnsa.png" width=150px></a>

    

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="api/index.html" title="Cymetric API"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Cymetric"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Home</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" ><span style="font-variant:small-caps;">Cyclus</span> User Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Cymetric</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2016, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Apr 27, 2017.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>